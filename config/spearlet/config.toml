# SPEARlet Configuration / SPEARlet 配置

[spearlet]
# Node name (optional) / 节点名称（可选）
node_name = ""
# SMS gRPC address / SMS gRPC地址
sms_grpc_addr = "127.0.0.1:50051"
# SMS HTTP gateway address (for sms+file downloads) / SMS HTTP网关地址（用于sms+file下载）
sms_http_addr = "127.0.0.1:8080"
# Auto register with SMS / 自动向SMS注册
auto_register = true
# Heartbeat interval (seconds) / 心跳间隔（秒）
heartbeat_interval = 30
# Cleanup interval (seconds) / 清理间隔（秒）
cleanup_interval = 300

[spearlet.grpc]
# gRPC bind address / gRPC绑定地址
addr = "0.0.0.0:50052"
# Enable TLS / 启用TLS
enable_tls = false

[spearlet.http]
# Enable CORS / 启用CORS
cors_enabled = true
# Enable Swagger UI / 启用Swagger UI
swagger_enabled = true

[spearlet.http.server]
# HTTP bind address / HTTP绑定地址
addr = "0.0.0.0:8081"

[spearlet.storage]
# Storage backend: "memory" or "sled" / 存储后端："memory" 或 "sled"
backend = "memory"
# Data directory / 数据目录
data_dir = "./data/spearlet"
# Max cache size (MB) / 最大缓存大小（MB）
max_cache_size_mb = 512
# Enable compression / 启用压缩
compression_enabled = true
# Max object size (bytes) / 最大对象大小（字节）
max_object_size = 67108864

[spearlet.logging]
# Log level: trace/debug/info/warn/error / 日志级别
level = "debug"
# Log format: json/pretty / 日志格式
format = "pretty"
# Log output file (optional) / 日志输出文件（可选）
file = "./logs/spearlet.log"

[spearlet.llm]
# Backend routing policy / 后端路由策略
default_policy = "weighted_random"

[spearlet.llm.discovery.ollama]
# Enable importing Ollama currently serving models / 是否导入 Ollama 当前正在 serve 的模型
enabled = true
# Discovery scope: serving|installed / 导入范围：serving|installed
scope = "serving"
# Ollama base URL / Ollama 服务地址
base_url = "http://127.0.0.1:11434"
# Allow non-loopback base_url (SSRF risk) / 是否允许非本机地址（有 SSRF 风险）
allow_remote = false
# HTTP request timeout (ms) / HTTP 请求超时（毫秒）
timeout_ms = 1500
# Max models to import per refresh / 每次最多导入的模型数量
max_models = 32
# Allowlist of model names (exact match); empty means allow all / 模型白名单（精确匹配）；空表示允许全部
allow_models = []
# Denylist of model names (exact match) / 模型黑名单（精确匹配）
deny_models = []
# Imported backend name prefix / 导入后 backend 名称前缀
name_prefix = "ollama/"
# How to handle name conflicts: skip|overwrite / 命名冲突处理：skip|overwrite
name_conflict = "skip"
# Default routing weight / 默认权重
default_weight = 100
# Default routing priority / 默认优先级
default_priority = 0
# Default operations / 默认能力（操作）
default_ops = ["chat_completions"]
# Default features / 默认特性
default_features = []
# Default transports / 默认传输方式
default_transports = ["http"]

[[spearlet.llm.credentials]]
# Credential name / 凭据名称
name = "openai_chat"
# v1: env only / v1 仅支持 env
kind = "env"
# Environment variable name that holds the API key / 存放 API key 的环境变量名
api_key_env = "OPENAI_API_KEY"

[[spearlet.llm.credentials]]
name = "openai_realtime"
kind = "env"
api_key_env = "OPENAI_API_KEY"

[[spearlet.llm.backends]]
name = "openai-chat"
kind = "openai_chat_completion"
base_url = "https://api.openai.com/v1"
model = "gpt-4o-mini"
credential_ref = "openai_chat"
ops = ["chat_completions"]
features = ["supports_tools", "supports_json_schema"]
transports = ["http"]
weight = 100
priority = 0

[[spearlet.llm.backends]]
name = "openai-realtime-asr"
kind = "openai_realtime_ws"
base_url = "https://api.openai.com/v1"
credential_ref = "openai_realtime"
ops = ["speech_to_text"]
features = []
transports = ["websocket"]
weight = 100
priority = 0
